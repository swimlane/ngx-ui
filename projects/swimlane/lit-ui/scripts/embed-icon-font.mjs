/**
 * Reads the icon font from ngx-ui (single source of truth), base64-encodes it,
 * and writes a generated TS file so the swim-icon component can embed the font
 * via a data URI. No host @font-face required.
 *
 * Source: projects/swimlane/ngx-ui/src/lib/assets/icons/iconfont/fonts/ngx-icon.woff2
 */
import { readFileSync, writeFileSync, existsSync } from 'fs';
import { resolve, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const litUiRoot = resolve(__dirname, '..');
const ngxUiFontsDir = resolve(litUiRoot, '../ngx-ui/src/lib/assets/icons/iconfont/fonts');
const fontPath = resolve(ngxUiFontsDir, 'ngx-icon.woff2');
const outPath = resolve(litUiRoot, 'src/components/icon/icon-font-base64.generated.ts');

if (!existsSync(fontPath)) {
  console.error(
    `[embed-icon-font] Font not found: ${fontPath}\n` +
      'Ensure ngx-ui is present at projects/swimlane/ngx-ui and ngx-icon.woff2 exists.'
  );
  process.exit(1);
}

const buffer = readFileSync(fontPath);
const base64 = buffer.toString('base64');

const content = `/**
 * Generated by scripts/embed-icon-font.mjs – do not edit.
 * Source: projects/swimlane/ngx-ui/src/lib/assets/icons/iconfont/fonts/ngx-icon.woff2
 */
export const ICON_FONT_BASE64 = '${base64}';\n`;

writeFileSync(outPath, content, 'utf8');
console.log(`[embed-icon-font] Embedded ngx-icon.woff2 → icon-font-base64.generated.ts (${(buffer.length / 1024).toFixed(1)} KB).`);
