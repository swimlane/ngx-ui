@if (model !== undefined) {
  <div class="json-tree-node-flat">
    @if (!(nextLevel === -1 && hideRoot)) {
      <div class="node-container">
        @if (nextLevel > 0) {
          <div class="indentation" [style.left]="-1 * (nextLevel * 20) + 'px'">
            @for (separator of indentationArray; track $index) {
              <span class="json-editor--vertical-separator"></span>
            }
          </div>
        }
        <div class="node">
          <div class="left-options">
            @if ((!valid && !schemaBuilderMode) || isDuplicated) {
              <div class="error-box"></div>
            }
            @if (hideRoot || (nextLevel > 0 && !arrayItem)) {
              <ng-content select="[cdkDragHandle]"></ng-content>
            }
          </div>
          <div class="node-content" [class.extra-margin]="schema.nameEditable && !schemaBuilderMode">
            <div class="node-info">
              <ngx-json-editor-node-info
                [nameEditable]="schema.nameEditable && !schemaBuilderMode"
                [propertyName]="arrayName ? arrayName : schema?.propertyName"
                (propertyNameChange)="updatePropertyName(schema.id, $event)"
                [title]="schema?.title || label || (arrayItem ? 'Items' : schema?.propertyName)"
                [type]="((schema?.format && schema?.format !== 'binary' ? schema?.format : schema?.type) | titlecase) + (schema?.enum?.length ? ' + Enum' : '')"
                [description]="schema?.description"
                [examples]="schema?.examples"
                [required]="required"
                >
              </ngx-json-editor-node-info>
            </div>
            @if (!schemaBuilderMode) {
              <div class="node-input">
                @if (inputControlTemplate) {
                  <ng-container *ngTemplateOutlet="inputControlTemplate; context: { nodeModel: model, nodeSchema: schema, nodePath: path, nodeChangeValue$: nodeChangeValue$, nodeContext: contextItem, nodeExpandTrigger$: nodeExpandTrigger$}"></ng-container>
                }
                @if (!inputControlTemplate) {
                  <!-- Number | Integer -->
                  @if (schema?.type === 'number' || schema?.type === 'integer') {
                    <div>
                      <ngx-input
                        appearance="fill"
                        type="number"
                        [ngModel]="model"
                        (ngModelChange)="updateModel($event)"
                        [requiredIndicator]="false"
                        [required]="required"
                        [disabled]="isDuplicated"
                      ></ngx-input>
                    </div>
                  }
                  <!-- Boolean -->
                  @if (schema?.type === 'boolean') {
                    <div>
                      <ngx-toggle
                        class="toggle-input"
                        [ngModel]="model"
                        (ngModelChange)="updateModel($event)"
                        [label]="model | json"
                        [disabled]="isDuplicated"
                        >
                      </ngx-toggle>
                    </div>
                  }
                  <!-- String -->
                  @if (schema?.type === 'string') {
                    <!-- No format -->
                    @if (!schema.format || schema.format === 'binary') {
                      <div>
                        @if (!schema?.enum) {
                          <ngx-input
                            appearance="fill"
                            type="textarea"
                            [ngModel]="model"
                            (ngModelChange)="updateModel($event)"
                            [requiredIndicator]="false"
                            [required]="required"
                            [disabled]="isDuplicated"
                            [autosize]="false"
                            >
                          </ngx-input>
                        }
                        @if (schema?.enum) {
                          <ngx-select
                            appearance="fill"
                            [filterable]="false"
                            [ngModel]="[model]"
                            (ngModelChange)="updateModel($event[0] || [''])"
                            [required]="required"
                            [disabled]="isDuplicated"
                            >
                            @for (option of schema.enum; track option) {
                              <ngx-select-option [name]="option" [value]="option">
                              </ngx-select-option>
                            }
                          </ngx-select>
                        }
                      </div>
                    }
                    <!-- Password -->
                    @if (schema.format === 'password') {
                      <div>
                        <ngx-input
                          appearance="fill"
                          type="password"
                          [ngModel]="model"
                          (ngModelChange)="updateModel($event)"
                          [requiredIndicator]="false"
                          [required]="required"
                          [disabled]="isDuplicated"
                          [passwordToggleEnabled]="passwordToggleEnabled"
                        ></ngx-input>
                      </div>
                    }
                    <!-- Date -->
                    @if (schema.format === 'date') {
                      <div>
                        <ngx-input
                          type="date"
                          [ngModel]="model"
                          (ngModelChange)="updateModel($event)"
                          [requiredIndicator]="false"
                          [required]="required"
                          [disabled]="isDuplicated"
                        ></ngx-input>
                      </div>
                    }
                    <!-- DateTime -->
                    @if (schema.format === 'date-time') {
                      <div>
                        <ngx-input
                          type="datetime-local"
                          [ngModel]="model"
                          (ngModelChange)="updateDateTime($event)"
                          [requiredIndicator]="false"
                          [required]="required"
                          [disabled]="isDuplicated"
                        ></ngx-input>
                      </div>
                    }
                    <!-- Code -->
                    @if (schema.format === 'code') {
                      <div class="code">
                        <ngx-input
                          type="text"
                          [ngModel]="model"
                          [requiredIndicator]="false"
                          [required]="required"
                          [disabled]="true"
                          >
                          <ngx-input-suffix>
                            <button [disabled]="isDuplicated" (click)="openCodeEditor()">
                              <ngx-icon fontIcon="edit" class="edit-code-icon" ngx-tooltip tooltipTitle="Edit Code"> </ngx-icon>
                            </button>
                          </ngx-input-suffix>
                        </ngx-input>
                      </div>
                    }
                    <ng-template #codeEditorTpl>
                      <div class="code-editor">
                        <ngx-select
                          label="Language Mode"
                          [ngModel]="[editorConfig.mode.name]"
                          (ngModelChange)="selectEditorMode($event[0])"
                          >
                          @for (mode of editorModes; track mode) {
                            <ngx-select-option [name]="mode.label" [value]="mode.name">
                            </ngx-select-option>
                          }
                        </ngx-select>
                        <ngx-button
                          class="btn btn-primary save-code-button"
                          (click)="updateModel(editorModel); closeCodeEditor()"
                          >
                          Save</ngx-button
                          >
                          @if (editorVisible) {
                            <ngx-codemirror
                              [ngModel]="editorModel"
                              (ngModelChange)="editorModel = $event"
                              [config]="editorConfig"
                              class="code-editor"
                              >
                            </ngx-codemirror>
                          }
                        </div>
                      </ng-template>
                    }
                    <div class="input-error">
                      @for (error of ownErrors; track error) {
                        <span>{{ error.message }}</span>
                      }
                    </div>
                  }
                </div>
              }
              @if (schemaBuilderMode) {
                <div class="node-constrains">
                  @if (schema.minItems) {
                    <div class="tag">Min Items: {{ schema.minItems }}</div>
                  }
                  @if (schema.maxItems) {
                    <div class="tag">Max Items: {{ schema.maxItems }}</div>
                  }
                  @if (schema.minimum) {
                    <div class="tag">Minimum: {{ schema.minimum }}</div>
                  }
                  @if (schema.maximum) {
                    <div class="tag">Maximum: {{ schema.maximum }}</div>
                  }
                  @if (schema.minLength) {
                    <div class="tag">Min Length: {{ schema.minLength }}</div>
                  }
                  @if (schema.maxLength) {
                    <div class="tag">Max Length: {{ schema.maxLength }}</div>
                  }
                  @if (schema.pattern) {
                    <div class="tag">Pattern: Yes</div>
                  }
                </div>
              }
              <ng-content select="[node-options]"></ng-content>
            </div>
          </div>
        </div>
      }
      <!-- Object -->
      @if (schema?.type === 'object') {
        <div>
          <ngx-json-object-node-flat
            [schema]="schema"
            [schemaRef]="schemaRef"
            [model]="model"
            [expanded]="expanded"
            [hideRoot]="hideRoot"
            (modelChange)="updateModel($event)"
            [path]="path"
            [errors]="childrenErrors"
            [isDuplicated]="isDuplicated"
            [typeCheckOverrides]="typeCheckOverrides"
            [level]="nextLevel"
            [schemaBuilderMode]="schemaBuilderMode"
            [formats]="formats"
            [showKnownProperties]="showKnownProperties"
            [passwordToggleEnabled]="passwordToggleEnabled"
            [inputControlTemplate]="inputControlTemplate"
            (schemaUpdate)="schemaUpdate.emit(schemaRef)"
            >
          </ngx-json-object-node-flat>
        </div>
      }
      <!-- Array -->
      @if (schema?.type === 'array') {
        <div>
          <ngx-json-array-node-flat
            [schema]="schema"
            [schemaRef]="schemaRef"
            [model]="model"
            [expanded]="expanded"
            [formats]="formats"
            [hideRoot]="hideRoot"
            (modelChange)="updateModel($event)"
            [path]="path"
            [errors]="childrenErrors"
            [typeCheckOverrides]="typeCheckOverrides"
            [level]="nextLevel"
            [isDuplicated]="isDuplicated"
            [schemaBuilderMode]="schemaBuilderMode"
            [showKnownProperties]="showKnownProperties"
            [passwordToggleEnabled]="passwordToggleEnabled"
            [inputControlTemplate]="inputControlTemplate"
            (schemaUpdate)="schemaUpdate.emit(schemaRef)"
            >
          </ngx-json-array-node-flat>
        </div>
      }
    </div>
  }
