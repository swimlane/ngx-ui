<div class="array-node-v2" [hidden]="!expanded">
  <div class="array-node-content" *ngFor="let value of model; let i = index; trackBy: arrayTrackBy">
    <ngx-json-editor-node-v2 [model]="value" (modelChange)="updateArrayItem(i, $event)" [schema]="schemas[i]"
      [path]="path + '[' + i + ']'" [errors]="errors" [typeCheckOverrides]="typeCheckOverrides" [level]="level">
      <ngx-dropdown [showCaret]="true">
        <ngx-dropdown-toggle>
          <button type="button" class="node-options">
            <i class="ngx-icon ngx-dots-vert-round"></i>
          </button>
        </ngx-dropdown-toggle>
        <ngx-dropdown-menu class="ngx-dropdown-dark-outline">
          <ul class="vertical-list">
            <li><button type="button" (click)="deleteArrayItem(i)">Delete</button></li>

            <ng-container *ngIf="schemas[i]?.$meta?.type">
              <li *ngFor="let type of schemas[i]?.$meta?.type">
                <button type="button" (click)="changeItemType(i, type)" [disabled]="schemas[i].currentType === type">
                  Change type to {{ dataTypeMap[type].name }}
                </button>
              </li>
            </ng-container>
          </ul>
        </ngx-dropdown-menu>
      </ngx-dropdown>
    </ngx-json-editor-node-v2>
  </div>

  <div class="add-button" [class.background]="level" [style.left]="-1 *level * 20 + 'px'"
    [ngStyle]="{'width': 'calc(100% + ' + level * 20 + 'px)'}">
    <div class="indented-content" [style.marginLeft]="level * 20 - (level ? 7 : 0) + 'px'">
      <ngx-dropdown [showCaret]="true">
        <ngx-dropdown-toggle>
          <button type="button">
            <i class="ngx-icon ngx-tree-expand"></i>
            <span>Add an item</span>
          </button>
        </ngx-dropdown-toggle>
        <ngx-dropdown-menu class="ngx-dropdown-dark-outline">
          <ul class="vertical-list">
            <ng-template [ngIf]="!schema || !schema.items || !schema.items.type">
              <li *ngFor="let dataType of dataTypes" (click)="addArrayItem(dataType)">
                <button type="button">{{ dataType.name }}</button>
              </li>
            </ng-template>
            <ng-container *ngIf="schema?.items?.type">
              <li *ngIf="!_array.isArray(schema.items.type)">
                <button type="button" (click)="addArrayItem()">Add</button>
              </li>
              <ng-container *ngIf="_array.isArray(schema.items.type)">
                <li *ngFor="let type of schema.items.type">
                  <button type="button" (click)="addArrayItem(dataTypeMap[type])">Add
                    {{ dataTypeMap[type].name }}</button>
                </li>
              </ng-container>
            </ng-container>
          </ul>
        </ngx-dropdown-menu>
      </ngx-dropdown>
    </div>
  </div>
</div>