<div class="ngx-select-wrap">
  <ng-container *ngIf="type === FilterType.Select">
    <div class="ngx-select-flex-wrap" [style.min-width]="autosize ? autosizeMinWidth : undefined">
    <div class="ngx-select-flex-wrap-inner">
      <div class="ngx-chip" (click)="onToggle($event)" [class.has-controls]="hasControls">
        <div class="ngx-chip__contents">
          <button *ngIf="ngxIconClass && ngxIconPosition === FilterIconPositionTypes.Left" type="button" aria-label="Filter Icon" class="ngx-chip-icon-left">
            <i class="ngx-icon" [ngClass]="ngxIconClass"></i>
          </button>
          <span *ngIf="label" class="ngx-chip-label"> {{ label }}: </span>
          <span class="ngx-chip-value">
            <span *ngIf="!value?.length">{{ placeholder }} </span>
            <ng-container *ngIf="showCount">
              <span *ngIf="value?.length > 1">{{ value.length }} Selected</span>
              <span *ngIf="value?.length === 1" [innerHTML]="selection"></span>
            </ng-container>
          </span>
          <button *ngIf="ngxIconClass && ngxIconPosition === FilterIconPositionTypes.Right" type="button" aria-label="Filter Icon" class="ngx-chip-icon-right">
            <i class="ngx-icon" [ngClass]="ngxIconClass"></i>
          </button>
        </div>

        <div class="ngx-chip__controls" *ngIf="hasControls">
          <button
            type="button"
            *ngIf="clearVisible"
            title="Clear Selections"
            aria-label="Clear Selections"
            class="ngx-chip-clear"
            (click)="onClear()"
          >
            <i class="ngx-icon ngx-x"></i>
          </button>
          <button type="button" *ngIf="caretVisible" aria-label="Toggle Dropdown" class="ngx-chip-caret">
            <i class="ngx-icon ngx-chevron-bold-down"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <ngx-select-dropdown
    *ngIf="dropdownVisible"
    [class.ngx-select-dropdown--left]="itemsPosition === FilterSelectItemPositionTypes.Left"
    [class.ngx-select-dropdown--right]="itemsPosition === FilterSelectItemPositionTypes.Right"
    [focusIndex]="focusIndex"
    [filterQuery]="filterQuery"
    [filterPlaceholder]="filterPlaceholder"
    [filterCaseSensitive]="filterCaseSensitive"
    [allowAdditions]="false"
    [showSelectAll]="multiple && showSelectAll"
    [selected]="value"
    [groupBy]="groupBy"
    [groupByTemplate]="groupByTemplate"
    [emptyPlaceholder]="emptyPlaceholder"
    [tagging]="false"
    [filterEmptyPlaceholder]="filterEmptyPlaceholder"
    [filterable]="filterable"
    [identifier]="identifier"
    [options]="options"
    (keyup)="keyup.emit($event)"
    (close)="onClose()"
    (clearQueryFilter)="clearQueryFilter.emit()"
    (selection)="onDropdownSelection($event)"
    (selectAll)="onSelectAll()"
    (deselection)="onDropdownDeselection($event)"
    (keyboardSelection)="onDropdownSelection($event, false)"
    (keyboardDeselection)="onDropdownDeselection($event, false)"
  >
  </ngx-select-dropdown>
  </ng-container>
  <ng-container *ngIf="type === FilterType.Button">
    <div class="ngx-filter-button">
      <ng-container *ngTemplateOutlet="buttonControlTemplate"></ng-container>
    </div>
  </ng-container>
  <ng-container *ngIf="type === FilterType.CustomDropdown && customDropdownConfig?.component?.type" >
    <ngx-dropdown [closeOnClick]="customDropdownConfig.closeOnClick ?? true" [closeOnOutsideClick]="customDropdownConfig.closeOnOutsideClick ?? true" [showCaret]="customDropdownConfig.showCaret">
      <ngx-dropdown-toggle (toggle)="onCustomDropdownToggle()" [disabled]="disabled">
        <ng-container *ngTemplateOutlet="buttonControlTemplate"></ng-container>
      </ngx-dropdown-toggle>
      <ngx-dropdown-menu [class.align-right]="itemsPosition === FilterSelectItemPositionTypes.Right">
        <div class="ngx-filter-dynamic-wrapper" [ngClass]="customDropdownConfig.containerClasses">
          <ng-container #dynamicContainer></ng-container>
        </div>
      </ngx-dropdown-menu>
    </ngx-dropdown>
  </ng-container>
</div>

<ng-template #buttonControlTemplate>
  <div class="ngx-filter-button">
      <button type="button" class="ngx-chip" (click)="onFilterButtonClick()" [disabled]="disabled" aria-label="Filter Button">
        <div class="ngx-chip__contents">
          <ng-container *ngIf="ngxIconClass && ngxIconPosition === FilterIconPositionTypes.Left">
            <i class="ngx-icon ngx-chip-icon-left" [ngClass]="ngxIconClass" aria-label="Button Icon"></i>
          </ng-container>

          <span class="ngx-chip-label">{{ label }}</span>

          <ng-container *ngIf="ngxIconClass && ngxIconPosition === FilterIconPositionTypes.Right">
            <i class="ngx-icon ngx-chip-icon-right" [ngClass]="ngxIconClass" aria-label="Button Icon"></i>
          </ng-container>
        </div>
        <div class="ngx-chip__count" *ngIf="hasSelections && showCount">
          <span class="ngx-chip__count-circle">
            <span class="count-badge">{{ filterCount }}</span>
          </span>
        </div>
      </button>
    </div>
</ng-template>
